!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(n.gondel={})}(this,function(n){"use strict";var a=function(n,e,t){return t(n)},c=window.__gondelPluginEvents||{};function p(n,e,t,o){var r,i=!1;if((c[n]||a)(e,t,function(n){i=!0,r=o?o(n):n}),!i)throw new Error("Async plugin listener");return r}function e(n,i){c[n]||(c[n]=a);var e=c[n];c[n]=function(n,o,r){e(n,o,function(n,e,t){i(n,o,function(n){r(n,o,t)})})}}window.__gondelPluginEvents=c;var r=function(){function n(){this._components={},this._activeComponents={}}return n.prototype.registerComponent=function(n,e){this._components[n]=e},n.prototype.unregisterComponent=function(n){delete this._components[n]},n.prototype.getComponent=function(n){return this._components[n]},n.prototype.setActiveState=function(n,e){this._activeComponents[n]=e},n}(),i=window.__gondelRegistries=window.__gondelRegistries||{};function o(){var n=arguments,e=n[0],t="string"==typeof n[1]?n[1]:"g",o=n[n.length-1];i[t]||(i[t]=new r),i[t].getComponent(e)&&p("unregister",o,{componentName:e,namespace:t}),p("register",o,{componentName:e,namespace:t,gondelComponentRegistry:i[t]},function(n){i[t].registerComponent(e,n)})}function d(n,e,t,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var i=document.createEvent("Event"),a=t?s(t):e._ctx;if(n[0]!==e._namespace)throw new Error("Invalid event name '"+n+"' - use '"+e._namespace+n.charAt(0).toUpperCase()+n.slice(1)+"'");return i.initEvent(n,r,!0),i.data={component:e,name:e._componentName,namespace:e._namespace,eventData:o},a.dispatchEvent(i)}var m=function(){},l=function(){var e=this;this.promise=new Promise(function(n){e.resolve=n})};function t(e,n,o){var t=Array.prototype.slice.call(n.querySelectorAll("[data-"+o+"-name]"));n.hasAttribute("data-"+o+"-name")&&t.push(n);var r=t.filter(function(n){return e=o,!n.hasOwnProperty(h+e);var e}),i=new l;r.forEach(function(n){var e,t;e=n,t=i.promise,e[h+o]=t});var a,c,u=p("boot",r,{namespace:o},function(n){return n.map(function(n){return function(n,e,t){var o=n.getAttribute("data-"+t+"-name"),r=e.getComponent(o);if(void 0===r)throw new Error("Failed to boot component - "+o+" is not registred");var i=new r(n,o);return i._ctx=n,i._namespace=t,i._componentName=o,i.stop=function(n,e,t){d(t+"Stop",n,n._ctx),delete n._ctx[g+t],delete n._ctx[h+t],n._stopped=!0,p("stop",n,{namespace:t},e.bind(n))}.bind(null,i,i.stop||m,t),n["_gondel_"+t]=i}(n,e,o)})}),s=(a=e,c={},u.forEach(function(n){return c[n._componentName]=!0}),Object.keys(c).filter(function(n){return!a._activeComponents[n]}));s.forEach(function(n){return e.setActiveState(n,!0)});var f=p("start",u,{newComponentNames:s,namespace:o,gondelComponentRegistry:e},function(n){return Promise.all(n.map(v))}).then(function(){return u.forEach(function(n){n.sync&&n.sync()}),p("sync",u,{namespace:o})});return f.then(i.resolve,i.resolve).then(function(){return f}),f}function v(t){if(t.start)return 0===t.start.length?t.start():new Promise(function(n,e){return t.start(n,e)})}var g="_gondel_",h="_gondelA_";function s(n){return void 0!==n.nodeType?n:n[0]}function _(n,e){void 0===e&&(e="g");var t=s(n),o=t[g+e];if(o&&o._ctx)return o;throw new Error("Could not find any gondel component under "+t.nodeName+' in namespace "'+e+"\", \n    please check if your component is mounted via 'hasMountedGondelComponent'")}function u(n,e,t){void 0===n&&(n=document.documentElement),void 0===t&&(t="g");for(var o=[],r="_gondel_"+t,i=s(n).querySelectorAll("[data-"+t+"-name"+(e?'="'+e+'"':"")+"]"),a=0;a<i.length;a++){var c=i[a],u=c[r];u&&u._ctx===c&&o.push(u)}return o}var f={focus:"focusin",blur:"focusout"},y=window.__gondelDomEvents||{};window.__gondelDomEvents=y;var E=function(n,e){var t=window.Element.prototype,o=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.webkitMatchesSelector;return(E=function(n,e){return o.call(n,e)})(n,e)};function w(n,e,t,o){!function(n,e,t){for(var o=!1,r=[],i=0;i<n.length&&!e.cancelBubble;i++){var a=n[i],c=a.handlerOptions,u=_(a.ctx,t);if(u){Object.defineProperty(e,"currentTarget",{value:a.target,configurable:!0}),o=!0;for(var s=0;s<c.length&&!e.cancelBubble;s++){var f=u[c[s].handlerName].call(u,e);"function"==typeof f&&r.push(f)}}}r.forEach(function(n){n()}),o&&delete e.currentTarget}(function(r,i,n){var a=function(n){for(var e=[],t=n;t;t=t.parentElement)e.push(t);return e}(n),c=[];a.forEach(function(n,e){var t=n.getAttribute(r),o=t&&i[t];o&&c.push({index:e,handlers:o})});var u=[];return c.forEach(function(n){var t=n.index,o=n.handlers;Object.keys(o).forEach(function(n){if(!n)return u.push({index:t,ctx:a[t],target:a[t],handlerOptions:o[n]});for(var e=t;0<=--e;)if(E(a[e],n))return u.push({index:e,ctx:a[t],target:a[e],handlerOptions:o[n]})})}),0===u.length?[]:(u.sort(function(n,e){return n.index>e.index?1:n.index===e.index?0:-1}),u)}(e,t,o.target),o,n)}function C(n){return y[n]||(y[n]={}),y[n]}function b(o,r,n,e,t){var i=C(o);i[r]||(i[r]={},p("registerEvent",!0,{eventName:r,namespace:o,eventRegistry:i[r]},function(n){var e,t;n&&(e=r,t=o,document.documentElement.addEventListener(f[e]||e,w.bind(null,t,"data-"+t+"-name",y[t][e])))})),i[r][n]||(i[r][n]={});var a=("object"==typeof t?t:{selector:t}).selector||"";i[r][n][a]||(i[r][n][a]=[]),i[r][n][a].push(Object.assign({handlerName:e,handlerOption:t}))}var x=!1;function N(){x=!0,e("register",function(n,e,t){var o=e.componentName,r=e.namespace;if(!e.gondelComponentRegistry._activeComponents[o])return t(n);var i=n.prototype&&n.prototype.__events||n.__events;i&&i.forEach(function(n){b(r,n[0],o,n[1],n[2])}),t(n)}),e("unregister",function(n,e,t){var o=e.componentName;!function(n,e){var t=C(n);for(var o in t)t.hasOwnProperty(o)&&delete t[o][e]}(e.namespace,o),t(n)}),e("start",function(n,e,t){var o=e.newComponentNames,r=e.gondelComponentRegistry,i=e.namespace;o.forEach(function(e){var n=r.getComponent(e),t=n.prototype&&n.prototype.__events||n.__events;t&&t.forEach(function(n){b(i,n[0],e,n[1],n[2])})}),t(n)})}var A=function(){function n(){}return n.prototype.stop=function(){},n}();n.addGondelPluginEventListener=e,n.registerComponent=o,n.internalGondelRefAttribute=g,n.internalGondelAsyncRefAttribute=h,n.getFirstDomNode=s,n.startComponents=function(n,e){return void 0===e&&(e="g"),i[e]?t(i[e],n?s(n):document.documentElement,e):Promise.resolve([])},n.stopComponents=function(n,e){void 0===e&&(e="g");var t=u(n,void 0,e),o=n&&_(n);o&&t.unshift(o),t.forEach(function(n){return n.stop()})},n.hasMountedGondelComponent=function(n,e){void 0===e&&(e="g");var t=s(n)[g+e];return!(!t||!t._ctx)},n.getComponentByDomNode=_,n.getComponentByDomNodeAsync=function(n,e){void 0===e&&(e="g");var t=s(n),o=t[h+e];return o?o._ctx?Promise.resolve(o):o.then(function(){return t[g+e]}):Promise.reject(void 0)},n.findComponents=u,n.Component=function(e,t){return function(n){o(e,t,n)}},n.EventListener=function(t,o){return function(n,e){if(x||N(),"_"!==e.substr(0,1))throw new Error("Invalid handler name '"+e+"' use '_"+e+"' instead.");n.__events||(n.__events=[]),n.__events.push([t,e,o])}},n.triggerPublicEvent=d,n.GondelBaseComponent=A,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=gondel.es5.min.js.map
